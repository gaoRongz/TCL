require(["KUYU.Service","KUYU.plugins.alert","KUYU.Binder","KUYU.Store","juicer","lightbox"],function(){function t(){this.events={}}function e(t){if(!t)return!1;var e=document.createElement("div");return t=t.replace(/\s+/gi,""),e.innerHTML=t,e.innerText}function a(t){m.get({url:"/front/product/getProductFavourState",data:{productUuid:t,ranNum:Math.ceil(1e5*Math.random())},success:function(e){var a=e.retData;a&&(a=a.favoriteState),e.code==CODEMAP.status.success&&("1"==a?$(".purc-start").html('<em class="active">&#xe636;</em>取消收藏'):$(".purc-start").html('<em class="">&#xe636;</em>收藏')),$(".purc-start").attr({"data-uuid":t,onclick:"KUYU.setCollect('"+t+"','"+a+"','"+e.code+"')"})}})}function i(t){m.post({url:"/front/product/createQrCode",data:{productUuid:t,ranNum:Math.random()},success:function(t){$(".pQrCode").each(function(e,a){a.src=t.retData})}})}function o(t){var e=$(".y_servicetab li"),a=e.length;a>0&&e.width(1/a*100+"%"),$(".y_servicetab li").click(function(){$(this).addClass("active").siblings().removeClass("active"),$(".y_sercecontent .y_sercepane").eq($(this).index()).addClass("active").siblings().removeClass("active")})}function s(t){$(window).scroll(function(e){var a,i,o,s,r;a=$("#details-l").length>0?$("#details-l").offset().top-50:0,i=$("#policy").length>0?$("#policy").offset().top-150:a,o=$("#question").length>0?$("#question").offset().top-150:i,s=$("#comment").length>0?$("#comment").offset().top-150:o,r=t.indexOf('<a name="productAttribute"></a>')>-1?$("a[name='productAttribute']").parent().offset().top-150:i,$(this).scrollTop()<r?$(".details-r ul li").eq(0).addClass("active").siblings().removeClass("active"):t.indexOf('<a name="productAttribute"></a>')>-1&&$(this).scrollTop()<i&&$(this).scrollTop()>r?$(".details-r ul li").eq(1).addClass("active").siblings().removeClass("active"):$(this).scrollTop()>i&&$(this).scrollTop()<o?$(".details-r ul li").eq(2).addClass("active").siblings().removeClass("active"):$("#comment").length>0?$(this).scrollTop()>o&&$(this).scrollTop()<s?$(".details-r ul li").eq(3).addClass("active").siblings().removeClass("active"):$(this).scrollTop()>s&&$(".details-r ul li").eq(4).addClass("active").siblings().removeClass("active"):$(this).scrollTop()>o?$(".details-r ul li").eq(3).addClass("active").siblings().removeClass("active"):$(this).scrollTop()>s&&$(".details-r ul li").eq(4).addClass("active").siblings().removeClass("active")})}function r(t,e){m.post({url:"/front/product/showProductComments",data:{productUuid:P,nowPage:t,pageShow:e,ranNum:Math.random()},success:function(t){if(t&&(u(t),t.wm)){var e=t.wm,a=e.totalNum,i=e.pageShow;c(e.nowPage,i,a)}}})}function u(t){var a="";if(t.commentList&&t.commentList.length>0)for(var i=0;i<t.commentList.length;i++){var o=t.commentList[i],s=o.firstShopComment,r=o.firstShopCommentScores,u=o.firstReplyComment,c=o.firstShowImgs,n=o.afterShopComment,d=o.afterReplyComment,m=o.afterShowImgs,p=o.specList;if(a+='<table cellspacing="0" cellpadding="0" class="comm-table">   <tr>       <td class="user-img">',o.customerImageUrl?a+='<img src="'+o.customerImageUrl+'" />':a+='<img src="../../app/images/default.png"/>',a+="</td><td>"+s.customerName+'   <span class="fr">'+l(s.appTime)+'</span></td><td class="user-star">   <ul class="comm-star star-r j-star">',r)for(var h=0;h<r.length;h++){var v=r[h];if("1"==v.appType)for(var f=1;f<=v.appScore;f++)a+='<li class="item active"></li>'}if(a+='   </ul></td></tr><tr>   <td></td>   <td>        <p class="tab-mar">'+e(s.comments)+"</p>",c&&c.length>0){a+='<p class="reply-img">';for(var h=0;h<c.length;h++){var g=c[h];a+='<a class="" href="'+g.imgUrl+'" data-lightbox="img">   <img class="maxheight" src="'+g.imgUrl+'"></a>'}a+="</p>"}if(a+="</td>",p){a+='<td class="text-c">   <div class="attr-text">';for(var h=0;h<p.length;h++){var y=p[h];a+="<span>"+y.value+"</span>"}a+="</div></td>"}if(a+="</tr>",u&&(a+='<tr>   <td>   </td>    <td class="comm-child">       <p class="child-img">           <img src="../../app/images/y_recomd5.jpg"/>           <span class="red">官方回复</span>           <span class="fr">'+l(u.operTime)+'</span>       </p>       <p class="child-img">'+u.replyContent+"</p></td><td></td></tr>"),n){if(a+='<tr>   <td></td>   <td class="comm-child">       <p class="child-img">',o.customerImageUrl?a+='<img src="'+o.customerImageUrl+'" />':a+='<img src="../../app/images/default.png"/>',a+='<span>买家追评</span><span class="fr">'+l(n.appTime)+"</span></p><p>"+e(n.comments)+'</p><p class="reply-img">',m){a+='<p class="reply-img">';for(var h=0;h<m.length;h++){var g=m[h];a+='<a href = "'+g.imgUrl+'" data-lightbox="img">   <img src="'+g.imgUrl+'"></a>'}a+="</p>"}a+="</p></td><td></tr>"}d&&(a+='<tr>   <td></td>   <td class="comm-child">       <p class="child-img">           <img src="../../app/images/y_recomd5.jpg"/>           <span class="red">官方回复</span>       <span class="fr">'+l(d.operTime)+'       </span></p>       <p class="child-img">'+d.replyContent+"</p>   </td>   <td></td></tr>"),a+="</table>"}$(".commentList").html(a)}function c(t,e,a){if(totalPage=Math.ceil(a/e),x.nowPage=t,x.pageShow=e,x.totalNum=a,x.totalPage=totalPage,html="",totalPage<8){if(html+='<button class="prev" ',1==t&&(html+="disabled"),html+=' style="background:#fff"><</button>',0!=totalPage)for(var i=1;i<=totalPage;i++)html+='<span class="item ',t==i&&(html+="active"),html+='" title="第'+i+'页">'+i+"</span>";else html+='<span class="item active" title="第1页">1</span>';html+='<button class="next" ',t==totalPage&&(html+="disabled"),html+=' style="background:#fff">></button>',$(".padding-box .clearmar").html(html)}else if(totalPage>=8&&t<7){html+='<button class="prev" ',1==t&&(html+="disabled"),html+=' style="background:#fff"><</button>';for(var i=1;i<=7;i++)html+='<span class="item ',t==i&&(html+="active"),html+='" title="第'+i+'页">'+i+"</span>";html+='<button class="next" ',t==totalPage&&(html+="disabled"),html+=' style="background:#fff">></button>',$(".padding-box .clearmar").html(html)}else{html+='<button class="prev" ',1==t&&(html+="disabled"),html+=' style="background:#fff"><</button>',html+='<span class="item" title="第1页">1</span>',html+='<span class="item" title="第2页">2</span>',html+='<span class="item" title="第3页">3</span>',html+='<span class="item" title="第...页">...</span>';var o=t-1,s=t+1,r=o-1;t==totalPage&&(html+='<span class="item" title="第'+r+'页">'+r+"</span>"),html+='<span class="item" title="第'+o+'页">'+o+"</span>",t<=totalPage&&(html+='<span class="item active" title="第'+t+'页">'+t+"</span>"),t+1<=totalPage&&(html+='<span class="item" title="第'+s+'页">'+s+"</span>"),html+='<button class="next" ',t==totalPage&&(html+="disabled"),html+=' style="background:#fff">></button>',$(".padding-box .clearmar").html(html)}}function l(t){t=new Date(t);var e=t.getFullYear(),a=t.getMonth()+1;a<10&&(a="0"+a);var i=t.getDate();return i<10&&(i="0"+i),e+"-"+a+"-"+i}function n(t){var e=$("#productad");t&&m.get({url:"/front/product/getAdByProductCategoryUuid?terminalType=01&platform=platform_tcl_shop&categoryUuid="+t,success:function(t){if(1==t.headState){var a="<div class='divs'><a href="+(t.headUrl?t.headUrl:"javascript:void(0)")+" ><img src="+t.headImg+" ></a></div>";e.html(a)}if(1==t.tailState){var i="<div class='divs'><a href="+(t.tailUrl?t.tailUrl:"javascript:void(0)")+" ><img src="+t.tailImg+" ></a></div>";$("#productadTail").html(i)}}})}function d(){$("#colorItem").html(),$("#sizeItem").html();$("#provinceId").val()&&$("#provinceId").val();var t=($("#areaUuid").val(),0),e=($("#skuNo").val(),$("#buyNum").val()),a=v.get("shoppingcart");if(a){var i=JSON.parse(a),o=i.storeMap[I.localStoreId];x.storeMap[I.localStoreId]=o}else x.storeMap[I.localStoreId]=[];$.each(x.storeMap[I.localStoreId],function(a,i){null==i.isSuitMain&&i.productUuid==P&&(t=parseInt(i.buyNum)+parseInt(e),i.buyNum=t)}),t<=0&&x.storeMap[I.localStoreId].push({productUuid:P,buyNum:e,attrId:I.skuNo,storeUuid:I.storeUuid,type:"01",nowPromotion:I.nowPromotion,opeTime:(new Date).getTime()}),v.set("shoppingcart",JSON.stringify(x)),p.nextPage("cart",{})}var m=KUYU.Service,p=KUYU.Init,h=KUYU.Binder,v=KUYU.Store,f=p.Map(),g=p.Map(),y=(KUYU.Init.getParam(),KUYU.Init.getEnv()),b=KUYU.Init.getService(),k=(b[y.sever],KUYU.RootScope);t.prototype.addEventListener=function(t,e){"function"==typeof e&&(this.events[t]=e)},t.prototype.dispatchEvent=function(t,e){var a={};a.body=e,this.events[t](a)};var U=new t,N=encodeURIComponent(location.href),P=$("#GLOBAL_UUID").val(),S=$("#GLOBAL_TYPE").val(),w=$("#GLOBAL_categoryUuid").val(),C=$("#secondParentCategoryName").val(),I={localStoreId:"03d03b6b05604c5cb065aef65b72972e"},x={storeMap:{}},M="";I.promotionUuid=$("#promotionUuid").val(),I.nowPromotion="",I.skuNo=$("#skuNo").val(),I.reserveOrderId=$("#reserveOrderId").val(),I.reservePromotionUuid=$("#reservePromotionUuid").val(),I.activeStatus=$("#activeStatus").val(),I.preSaleType=$("#preSaleType").val(),I.parentSkuNo=$("#parentSkuNo").val(),I.showTypedisp=$("#showTypedisp").val(),I.storeUuid=$("#storeUuid").val();var B={seckill:function(){function t(){if(o>0){o-=1;var t=Math.floor(o%60),e=Math.floor(o/60%60),a=Math.floor(o/3600%24),i=Math.floor(o/3600/24);$("#limit_endTime").html(i+"天"+a+"时"+e+"分"+t+"秒")}else window.clearInterval(InterValObj),"status2"==activeStatus?$("#limit_endTime").html("活动还没开始"):$("#limit_endTime").html("活动已结束")}var e=$('<a class="buy" id="buyAId" href="javascript:;" >立即购买</a>');$("#promotionSub").html(e);var a=$('<a href="javascript:;" class="buy" id="fixedFastBuy">立即购买</a>');$("#fixedBuy").html(a),R.getProvince(),B.skipGroupProduct(),r(1,5);var i=function(){var t=($("#productUuid").val(),$("#provinceId").val()),e=$("#cityId").val(),a=$("#region").val(),i=$("#areaUuid").val();$("#skuNo").val(),$("#limitpromotionUuid").val();m.get({url:"/cart/checkLimitBuy",data:{promotionUuid:I.promotionUuid,skuNo:I.skuNo,areaUuid:i,region:a,provinceId:t,cityId:e,_t:Math.random()},success:function(t){"true"==t.code?window.location.href="/pages/limitProduct/limitProduct.html?skuNo="+I.skuNo+"&promotionUuid="+I.promotionUuid+"&areaId="+i:1==t.code?window.location.href="http://user.tcl.com/proxy/login?from="+N:t.code==CODEMAP.status.TimeOut||t.code==CODEMAP.status.notLogin?Msg.Alert("","未登录",function(){window.location.href="http://user.tcl.com/proxy/login?from="+N}):Msg.Alert("",t.message,function(){})}})};e.on("click",function(t){$(this).hasClass("disabled")||i()}),a.on("click",function(t){$(this).hasClass("disabled")||i()});var o=parseInt($("#seckillTime").val(),10);t(),function(){""==$("#handEndTime").val()?InterValObj=window.setInterval(t,1e3):$("#limit_endTime").html("活动已结束")}()},skipGroupProduct:function(){$("#groupedProduct").on("click",".options .groupedproduct",function(){var t=$(this).attr("data-uuid");t&&(window.location.href=window.location.origin+"/"+t)})},ImgShow:function(){var t=$(".purc-img .item"),e=$(".purc-list .radius ");$.each(e,function(a,i){$(this).on("click",function(i){e.removeClass("active"),t.removeClass("active"),$(this).addClass("active"),t.eq(a).addClass("active")})})},upDateTime:function(){function t(){if(a>0){a-=1;var t=Math.floor(a%60),i=Math.floor(a/60%60),o=Math.floor(a/3600%24),s=Math.floor(a/3600/24);$("#daysId").html(s),$("#hoursId").html(o),$("#minutesId").html(i),$("#secondeId").html(t)}else window.clearInterval(e),window.location.reload()}var e,a=parseInt($("#SysSecond").val(),10);"status1"!=I.activeStatus&&"status2"!=I.activeStatus&&"status3"!=I.activeStatus&&"status4"!=I.activeStatus||(e=window.setInterval(t,1e3))}};if(localStorage.getItem("add")&&""!=localStorage.getItem("add"))var A=JSON.parse(localStorage.getItem("add")),T=A.province,D=A.city,_=A.region,O=A.street;else T="01",D="100",_="1000",O="10000";var R={param:{checkedProvince:T,checkedCity:D,checkedRegion:_,checkStreets:O},changeButton:function(t,e){$("#promotionSub"),$("#fixedBuy");"status2"==t?M="/front/product/addProductToOrder":"1"==e?M="/front/product/presaleProductToOrder":"2"==e&&(M="/front/product/presaleProductToOrder")},getProvince:function(){m.get({url:"/usercenter/region/getAllProvince",data:{time:Math.random()},success:function(t){t||Msg.Alert("","获取区域地址失败",function(){});var e=t;if(e.length>0){for(var a="",i=0;i<e.length;i++){var o=e[i],s="";o.uuid==R.param.checkedProvince&&(s=R.param.checkedProvince,$("#provincetitle").html(o.provinceName)),a=a+"<li provinceliid='"+o.uuid+"' onclick='getAddress.showCity(\""+o.uuid+'" ,"");\' >'+o.provinceName+"</li>"}a=a+"<input type='hidden'   name='province' id='provinceId'  value='"+s+"' />",$("#provinces").html(a),R.param.checkedProvince&&($("[provinceliid='"+R.param.checkedProvince+"']").parents(".m_areabox .mc").hide(),$("[provinceliid='"+R.param.checkedProvince+"']").parents(".m_areabox .mc").next(".m_areabox .mc").show(),$("#provinceId").val(R.param.checkedProvince))}""!=R.param.checkedProvince&&(""!=R.param.checkedCity&&(R.param.checkedCity,R.showCity(R.param.checkedProvince,R.param.checkedCity,R.param.checkedRegion,R.param.checkStreets)),R.param.checkedProvince),""!=R.param.checkedRegion&&R.param.checkedRegion,R.param.checkStreets,""==R.param.checkStreets&&($("#buyAId").addClass("disabled bespoke"),$("#fixedFastBuy").addClass("disabled bespoke"),$("#buyAId").attr("href","javascript:;"),$("#fixedFastBuy").attr("href","javascript:;"))},error:function(t){}})},showCity:function(t,e,a,i){$("#citytitle").html("请选择城市"),$("#regiontitle").html("请选择地区"),$("#streettitle").html("请选择街道"),$("#regions").html(""),$("#streets").html(""),m.get({url:"/usercenter/region/getCitysByProvinceUuid",data:{provinceUuid:t,time:Math.random()},success:function(i){for(var o=i,s="",r=0;r<o.length;r++){var u=o[r],c="";u.uuid==e&&(c=e,$("#citytitle").html(u.cityName)),0==r&&($("#cityId").val(u.uuid),$("#citytitle").html(u.name)),s=s+"<li cityliid='"+u.uuid+"'  onclick='getAddress.showRegion(\""+u.uuid+'" ,"");\' >'+u.cityName+"</li>"}s=s+"<input  type='hidden'   name='city' id='cityId'  value='"+c+"' />",$("#citys").html(s),$("#provincetitle").html($("[provinceliid='"+t+"']").html()),$("#provinceId").val(t),$("[provinceliid='"+t+"']").parents(".m_areabox .mc").hide(),$("[provinceliid='"+t+"']").parents(".m_areabox .mc").next(".m_areabox .mc").show(),$("#provincetitle").parent("li").removeClass("hover"),$("#citytitle").parent("li").addClass("hover"),e&&($("[cityliid='"+e+"']").parents(".m_areabox .mc").hide(),$("[cityliid='"+e+"']").parents(".m_areabox .mc").next(".m_areabox .mc").show(),$("#cityId").val(e),$("#citytitle").parent("li").removeClass("hover"),$("#regiontitle").parent("li").addClass("hover")),""!=e&&""!=a&&R.showRegion(e,R.param.checkedRegion,R.param.checkStreets)}})},showRegion:function(t,e,a){m.get({url:"/usercenter/region/getRegionsByCityUuid",data:{cityUuid:t,time:Math.random()},success:function(i){for(var o=i,s="",r=0;r<o.length;r++){var u=o[r],c="";u.uuid==e&&(c=e,$("#regintitle").html(u.regionName)),s=s+"<li  regionliid='"+u.uuid+"'  onclick='getAddress.showStreet(\""+u.uuid+'","");\'>'+u.regionName+"</li>"}s=s+"<input type='hidden'   name='region' id='region''  value='"+c+"' />",$("#regions").html(s),$("#citytitle").html($("li[cityliid='"+t+"']").html()),$("#cityId").val(t),$("[cityliid='"+t+"']").parents(".m_areabox .mc").hide(),$("[cityliid='"+t+"']").parents(".m_areabox .mc").next(".m_areabox .mc").show(),$("#citytitle").parent("li").removeClass("hover"),$("#regiontitle").parent("li").addClass("hover"),e&&($("[regionliid='"+e+"']").parents(".m_areabox .mc").hide(),$("[regionliid='"+e+"']").parents(".m_areabox .mc").next(".m_areabox .mc").show(),$("#region").val(_),$("#regiontitle").parent("li").removeClass("hover"),$("#streettitle").parent("li").addClass("hover")),""!=e&&""!=a&&R.showStreet(_,a)}})},showStreet:function(t,e){m.get({url:"/usercenter/region/getStreetsByRegionUuid",data:{regionUuid:t,time:Math.random()},success:function(a){for(var i=a,o="",s=0;s<i.length;s++){var r=i[s],u="";r.uuid==e&&(u=e,$("#streettitle").html(r.streetName)),o=o+"<li streetliid='"+r.uuid+"' onclick='getAddress.checkstock(\""+r.uuid+"\")' >"+r.streetName+"</li>"}o=o+"<input type='hidden' name='street' id='street'   value='"+u+"' />",$("#streets").html(o),$("#regiontitle").html($("li[regionliid='"+t+"']").html()),$("#region").val(t),$("[regionliid='"+t+"']").parents(".m_areabox .mc").hide(),$("[regionliid='"+t+"']").parents(".m_areabox .mc").next(".m_areabox .mc").show(),$("#regiontitle").parent("li").removeClass("hover"),$("#streettitle").parent("li").addClass("hover"),""!=e&&R.checkstock(e)}})},checkstock:function(t){$(".y_sendarea").removeClass("y_aretive"),$("#street").val(t),$("#streettitle").html($("li[streetliid='"+t+"']").html()),$("#areaUuid").val(t),R.updateAddressMsg(),R.hasProduct(),""!=R.param.checkedRegion&&(I.promotionUuid||R.getProductRelSuit(P,R.param.checkedRegion))},hasProduct:function(t){var e=$("#region").val(),a=$("#areaUuid").val(),i=I.skuNo,o=I.parentSkuNo,s=I.showTypedisp,r=$("#provinceId").val(),u=$("#buyNum"),c=$("#cityId").val(),l=$("#buyNum").val(),n=function(t){t.retData.totalNum&&t.retData.totalNum>0?(u.val(t.retData.totalNum).data("max",t.retData.totalNum),Msg.Alert("","库存不足，请减少库存尝试",function(){})):($("#isProduct").html("无货"),$("#fastBuy").attr("href","javascript:;"),$("#buyAId").attr("href","javascript:;"),$("#fixedFastBuy").attr("href","javascript:;"),$("#buyAId").addClass("bespoke disabled"),$("#fastBuy, #fixedFastBuy").addClass("fastBuyDisabled"),$("#fastBuy, #fixedFastBuy").attr("disabled",!0),$("#fastBuy, #fixedFastBuy").addClass("bespoke"),"subscribe"!=s&&($("#buyAId").removeClass("buy"),$("#buyAId").addClass("bespoke disabled")),"subscribe"!=s&&"reserve"!=s&&($("#fastBuy").attr("href","javascript:;"),$("#buyAId").attr("href","javascript:;")),u.val(1),Msg.Alert("","库存不足，请减少库存尝试",function(){}))};/^\d{1,7}$/.test(l)?l<=1&&(l=1):l>u.data("max")?(Msg.Alert("","库存不足，请减少库存尝试",function(){}),l=u.data("max"),u.val(l)):l=1;var d="/front/product/hasProduct",p={region:e,areaUuid:a,skuNo:i,buyNum:l,bcustomerUuid:"",bType:"",parentSkuNo:o,time:Math.random(),reservePromotionUuid:I.reservePromotionUuid};I.skuNo&&I.promotionUuid&&(d="/front/product/hasLimitProduct",p={region:e,areaUuid:a,skuNo:i,buyNum:l,bType:"",provinceId:r,promotionUuid:I.promotionUuid,cityId:c,parentSkuNo:o,time:Math.random()}),m.post({url:d,data:p,success:function(e){var a=e.retData;if(0==e.code){var i=I.activeStatus,o=I.preSaleType;a.hasProduct?(p.reservePromotionUuid&&(a.canBuy&&a.hasProduct&&a.totalNum>0?a.canBuy=!0:a.canBuy=!1),a.canBuy?(u.data("max",e.retData.totalNum),e.retData.totalNum&&l>e.retData.totalNum&&Msg.Alert("","库存不足，请减少库存尝试",function(){}),$("#isProduct").html("有货"),$("#buyAId").removeClass("bespoke disabled"),"true"!=S?R.changeButton(i,o):$("#buyNum").val(1),$("#buyAId").addClass("buy"),"subscribe"!=s&&"reserve"!=s&&($("#fastBuy, #fixedFastBuy").removeClass("fastBuyDisabled"),$("#fastBuy, #fixedFastBuy").attr("disabled",!1)),"reserve"==s&&($("#fastBuy, #fixedFastBuy").removeClass("fastBuyDisabled"),$("#fastBuy, #fixedFastBuy").attr("disabled",!1))):($("#isProduct").html("商品不在该销售区域内"),$("#buyAId").attr("href","javascript:;"),$("#buyAId").addClass("bespoke disabled"),$("#fastBuy, #fixedFastBuy").addClass("fastBuyDisabled"),$("#fastBuy, #fixedFastBuy").attr("disabled",!0),$("#fastBuy, #fixedFastBuy").addClass("bespoke"),"subscribe"!=s&&($("#buyAId").removeClass("buy"),$("#buyAId").addClass("bespoke")))):n(e),$.isFunction(t)&&t()}}})},getProductRelSuit:function(t,e){m.post({url:"/front/product/getSuitMainByRegion",data:{productUuid:P,regionId:e},success:function(t){var e=$("#suitList");if(I.Suit=t.retData,""!=I.Suit&&e.show(),"1"==t.code&&t.retData.length>0){var a=function(e){var a="";return $.each(e,function(e,i){var o=0,s="",r="";a+=' <div class="suit-item">',$.each(i.suitProductRellist,function(e,u){a+='<input type="hidden" suitUuid="'+i.uuid+'" class="suitproductskuno" value="'+u.skuNo+'" parentSkuNo="'+u.parentSkuNo+'" />',0!=o||P!=u.productUuid&&t.productUuid!=u.productUuid||(a+='<div class="sale-item">   <img style="width: 140px ; height: 140px" src="'+u.productSkuListModel.smallImg+'" />   <p class="name">'+u.productSkuListModel.productName+'</p>      <strong class="price">'+u.productSkuListModel.price+'元          <font class="suitSplitError" skuNo="'+u.skuNo+'"></font>      </strong></div>',o=1,s=u.uuid),r=u.storeUuid}),a+='<div class="sale-item sale-add">  <span class="sale-plus"></span></div>',$.each(i.suitProductRellist,function(t,e){e.buyNum||(e.buyNum=1),s!=e.uuid&&(a+=' <div class="sale-item">     <a href="/'+e.productUuid+'"><img style="width: 140px ; height: 140px" src="'+e.productSkuListModel.smallImg+'" /></a>     <p class="name">'+e.productSkuListModel.productName+'</p>      <strong class="price">'+e.productSkuListModel.price+'元          <font class="suitSplitError" skuNo="'+e.skuNo+'"></font>      </strong></div>')}),a+='   <div class="sale-item sale-add fr">      <p class="sale-text">商品搭配优惠</p>      <p class="sale-text">套装价</p>      <p class="sale-text font24">'+i.totalAmount+"<strong>元</strong></p>      <p><s>"+i.costAmount+'<strong>元</strong></s></p>      <button class="buy fastBuyDisabled buySuitBtn" index="'+e+'" storeUuid="'+r+'" suitUuid="'+i.uuid+'">立即购买</button>    </div> </div>'}),a};juicer.register("setDom",a);var i=juicer('<div class="sale">      <ul class="sale-tit">          {@each retData as suit , index}                   <li suitUuid="${suit.uuid}" class="item ${index ==0?"active":"" }">${suit.name}</li>          {@/each}      </ul>      <div class="sale-pro">             $${retData| setDom}      </div>  </div>',t);e.html(i);var o=$(".sale-tit li"),s=$(".sale-pro .suit-item");s.hide(),$.each(o,function(t,e){s.eq(0).show(),$(this).on("mouseover",function(){o.removeClass("active"),s.hide(),$(this).addClass("active"),s.eq(t).show()})}),R.hasSuitProduct(t.retData),$(".buySuitBtn").click(function(){var t=$(this).attr("suitUuid"),e=$(this).attr("index"),a=I.Suit,i=$("#areaUuid").val(),o=a[e],s=[],r=v.get("shoppingcart");if(r){var u=JSON.parse(r);I.storeUuid;var c=u.storeMap[I.localStoreId];x.storeMap[I.localStoreId]=c}else x.storeMap[I.localStoreId]=[];Array.prototype.map||(Array.prototype.map=function(t,e){var a,i,o;if(null==this)throw new TypeError(" this is null or not defined");var s=Object(this),r=s.length>>>0;if("[object Function]"!=Object.prototype.toString.call(t))throw new TypeError(t+" is not a function");for(e&&(a=e),i=new Array(r),o=0;o<r;){var u,c;o in s&&(u=s[o],c=t.call(a,u,o,s),i[o]=c),o++}return i});var l={},n={};x.storeMap[I.localStoreId].map(function(t,e,a){n[t.productUuid]=a[e],s.push(t.suitUuid)}),o.suitProductRellist.map(function(t,e,a){l[t.productUuid]=a[e]}),x.storeMap[I.localStoreId].length<2?$.each(o.suitProductRellist,function(t,e){x.storeMap[I.localStoreId].push({suitUuid:e.suitUuid,buyNum:e.buyNum,attrId:e.skuNo,isSuitMain:e.isSuitMain,distributorUuid:"",productUuid:e.productUuid,storeUuid:e.storeUuid,type:"01",opeTime:(new Date).getTime()})}):x.storeMap[I.localStoreId].map(function(t,e,a){l[t.productUuid]&&l[t.productUuid].suitUuid==t.suitUuid?t.buyNum=parseInt(t.buyNum)+1:o.suitProductRellist[e]&&-1==$.inArray(o.suitProductRellist[e].suitUuid,s)&&x.storeMap[I.localStoreId].push({suitUuid:o.suitProductRellist[e].suitUuid,buyNum:o.suitProductRellist[e].buyNum,attrId:o.suitProductRellist[e].skuNo,isSuitMain:o.suitProductRellist[e].isSuitMain,distributorUuid:"",storeUuid:o.suitProductRellist[e].storeUuid,type:"01",productUuid:o.suitProductRellist[e].productUuid,opeTime:(new Date).getTime()})}),m.post({url:"/front/product/addSuitProductToCartKuyu",data:{suitUuid:t,buyNum:1,distributorUuid:"",mainProductUuid:P,mainSkuNo:I.skuNo,areaUuid:i},success:function(t){t.code==CODEMAP.status.success?p.nextPage("cart",{}):(v.set("shoppingcart",JSON.stringify(x)),p.nextPage("cart",{}))}})})}}})},hasSuitProduct:function(t){var e=$("#region").val(),a=$("#areaUuid").val(),i=(I.skuNo,I.parentSkuNo,I.showTypedisp,$("#buyNum").val()),o=f,s=g,r={};$.each(t,function(t,e){var a=e.suitProductRellist,i=e.uuid,u={};u[i]=i,s.put(e.uuid,u),$.each(a,function(t,e){console.log(t,e);var a={sku:e.skuNo,parentUUid:i,parentSkuNo:e.parentSkuNo};o.put(e.skuNo+"_"+e.uuid,a),r[e.skuNo]=e.skuNo})});var u=o.values(),c=[];$.each(u,function(t,o){m.post({url:"/front/product/hasProduct",data:{region:e,areaUuid:a,skuNo:o.sku,buyNum:i||1,bcustomerUuid:"",bType:"",parentSkuNo:o.parentSkuNo,time:Math.random(),reservePromotionUuid:I.reservePromotionUuid},success:function(t){if(0!=t.code)return $(".suitSplitError[skuNo='"+o.sku+"']").text("(该区域无货)"),e.addClass("fastBuyDisabled"),$(".buySuitBtn").off("click"),!1;var e=$(".buySuitBtn[suituuid='"+s.get(o.parentUUid)[o.parentUUid]+"']");if(!(t.retData&&t.retData.canBuy&&t.retData.hasProduct&&t.retData.totalNum>0))return $(".suitSplitError[skuNo='"+o.sku+"']").text("(该区域无货)"),e.addClass("fastBuyDisabled"),$(".buySuitBtn").off("click"),!1;U.dispatchEvent("suit",{suit:o.sku,uuid:o.parentUUid,dom:e}),e.removeClass("fastBuyDisabled")}})}),U.addEventListener("suit",function(t){c.push(r[t.body.suit]),c.length==u.length&&t.body.dom.removeClass("fastBuyDisabled")})},goTOBuySuit:function(){var t=$(".productDetailSuitList .sale-tit li.active");t.attr("suitUuid"),$("#colorItem").html(),$("#sizeItem").html();$("#provinceId").val()&&$("#provinceId").val();$("#areaUuid").val(),$("#skuNo").val(),$("#buyNum").val()},updateAddressMsg:function(){var t=$("#provincetitle").html(),e=$("#citytitle").html(),a=$("#regiontitle").html(),i=$("#streettitle").html();$("#selectAreaNameId").html(t+" "+e+" "+a+" "+i).attr("title",t+" "+e+" "+a+" "+i),$(".y_sendarea .y_areasure").hover(function(){$(this).parents(".y_sendarea").addClass("y_aretive")}),$(".y_arelose").click(function(){$(this).parents(".y_sendarea").removeClass("y_aretive")}),$(".m_areabox .mt .tab li").click(function(){var t=$(this).index(".m_areabox .mt .tab li");$(this).addClass("hover").siblings().removeClass("hover"),$(".m_areabox .mc").eq(t).show().siblings(".m_areabox .mc").hide()}),$(document).on("click",function(){$(".y_sendarea").removeClass("y_aretive")}),$(".m_areabox").click(function(t){t.stopPropagation()})}},E={addBuyNum:function(){if(!(I.skuNo&&I.promotionUuid||I.reservePromotionUuid)){var t=parseInt($("#buyNum").val());if(t>=999)return void Msg.Alert("","超过购买上限",function(){});$("#buyNum").val(t+1),R.hasProduct()}},reduceBuyNum:function(){if(!(I.skuNo&&I.promotionUuid||I.reservePromotionUuid)){var t=parseInt($("#buyNum").val());if(t<=1)return void $("#buyNum").val(1);t-=1,$("#buyNum").val(t),R.hasProduct()}},changeBlur:function(t){if(I.reservePromotionUuid){return void $(t).val(1)}R.hasProduct(function(){if("status2"!=I.activeStatus){var e=$(t),a=e.val();/^[0-9]{1,3}$/.test(a)?/\d+/.test(a)&&e.val()<1&&e.val(1):/^\d+$/.test(a)?e.val(e.data("max")?e.data("max")>999?999:e.data("max")>999:1):e.val(1)}})}};!function(t){"true"==S?B.seckill():(B.skipGroupProduct(),B.upDateTime(),R.getProvince(),r(1,5))}(),function(){var t={};if(localStorage.getItem("add"))var t=JSON.parse(localStorage.getItem("add"));$("#provinces").on("click","li",function(){t.province=$(this).attr("provinceliid")}),$("#citys").on("click","li",function(){t.province&&(t.city=$(this).attr("cityliid"))}),$("#regions").on("click","li",function(){t.city&&(t.region=$(this).attr("regionliid"))}),$("#streets").on("click","li",function(){t.region&&(t.street=$(this).attr("streetliid")),localStorage.setItem("add",JSON.stringify(t)),window.location.reload()})}(),$(window).on("scroll",function(){var t=document.documentElement.scrollTop||document.body.scrollTop,e=$(".light-gray").offset().top-$(".fixed-buy").height();if(e<t){var a=t-e+"px";$(".fixed-buy").css({"margin-top":"0px"}),$(".details-r").show().css({top:a})}else $(".fixed-buy").css({"margin-top":"-60px"}),$(".details-r").hide().css({top:"0px"})}),KUYU.selectColor=function(t,e,a,i){if(!$(t).hasClass("active")){for(var o=$(t).parent().find("li"),s=0;s<o.length;s++)o.eq(s).hasClass("active")&&o.eq(s).removeClass("active");$(t).addClass("active");for(var r="",s=0;s<$(".colorItem").find(".active").length;s++)s<$(".colorItem").find(".active").length-1?r+=$(".colorItem").find(".active").eq(s).attr("attr-uuid")+"-":r+=$(".colorItem").find(".active").eq(s).attr("attr-uuid");I.skuNo=$("#"+r).attr("skuno"),I.parentSkuNo=$("#"+r).attr("parentskuno");var u=window.location.href.split("?")[0];window.location.href=u+"?skuNo="+$("#"+r).attr("skuno")}},KUYU.setCollect=function(t,e,a){function i(t){1==t?o("/front/product/cancelFavorite",function(t){"1"==t&&(r.data("cid","2"),r.find("em").removeClass("active"),r.html('<em class="">&#xe636;</em>收藏'))}):o("/front/product/collectProduct",function(t){"1"==t||"3"==t?(r.html('<em class="active">&#xe636;</em>取消收藏'),r.data("cid","1")):"403"==t.code&&Msg.Alert("","请登录",function(){window.location.href="http://user.tcl.com/proxy/login?from="+N})})}function o(e,a){m.get({url:e,data:{productUuid:t,ranNum:Math.random()},success:function(t){a(t)},error:function(t){throw t}})}var s=v.get("_ihome_token_"),r=$(".purc-start"),u=r.data("cid");s?i(void 0==u?e:u):Msg.Alert("","请登录",function(){window.location.href="http://user.tcl.com/proxy/login?from="+N})},$(document).on("click",".clearmar span:gt(0),.clearmar span:lt(8)",function(){nowPage=$(this).html(),nowPage.indexOf("...")>-1||($(this).addClass("active").siblings().removeClass("active"),r(nowPage,x.pageShow))}),$(document).on("click",".clearmar .prev",function(){x.nowPage>1&&(nowPage=x.nowPage-1),r(nowPage,x.pageShow)}),$(document).on("click",".clearmar .next",function(){x.nowPage<x.totalPage&&(nowPage=x.nowPage+1),r(nowPage,x.pageShow)}),window.getAddress=R,k.addBuyNum=E.addBuyNum,k.reduceBuyNum=E.reduceBuyNum,k.changeBlur=E.changeBlur,k.submitTOBuy=function(t){if($(t).hasClass("bespoke"))return!1;var e={productUuid:P,buyNum:1,skuNo:I.skuNo};if("status2"==I.activeStatus&&m.post({url:M,data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(t){403==t.code||"-6"==t.code?Msg.Alert("","会话失效或未登录",function(){window.location.href="http://user.tcl.com/proxy/login?from="+N}):p.nextPage("addProductToOrderKuyu",{title:$(".purc-name span").text(),secondParentCategoryName:C,skuNo:t.retData.skuNo,productId:t.retData.submodel.productUuid,buyNum:t.retData.productBuyNum,storeNote:t.retData.submodel.uuid,submodelUuid:t.retData.submodel.uuid,rushBuyBeginTime:t.retData.submodel.rushBuyBeginTime})}}),"status4"==I.activeStatus){var a=I.reserveOrderId;!function(t,e,a){m.post({url:e,data:t,success:function(t){t.code==CODEMAP.status.success?a(t):t.code==CODEMAP.status.notLogin||t.code==CODEMAP.status.TimeOut?Msg.Alert("",t.msg,function(){window.location.href="http://user.tcl.com/proxy/login?from="+N}):Msg.Alert("",t.msg,function(){})}})}({},"/tclcustomer/userInfo",function(t){""==a||null==a?Msg.Alert("","对不起!您没有预约不能参与抢购活动！",function(){}):p.nextPage("perserveBuyKuyu",{productUuid:P,reserveOrderId:I.reserveOrderId,skuNo:I.skuNo})})}},k.submitPreSaleTOBuy=function(){var t=$("#buyNum").val();"2"!=I.preSaleType&&"1"!=I.preSaleType||m.post({url:M,data:{dealerBcustomerUuid:"",pIds:P,buyNum:t,attrIds:I.skuNo,chooseCod:"",willType:2},success:function(e){e.code==CODEMAP.status.success?window.location.href="/pages/addProductToOrder/addProductToOrder.html?pIds="+P+"&attrIds="+I.skuNo+"&buyNum="+t+"&willType=2&preSale="+I.reservePromotionUuid:e.code!=CODEMAP.status.TimeOut&&e.code!=CODEMAP.status.notLogin||(window.location.href="http://user.tcl.com/proxy/login?from="+N)}})},k.toFastBuy=function(t){if($(t).hasClass("bespoke"))return!1;m.post({url:"/cart/removeKuyu",data:{productIdAndAttrId:"remove_"+P+"_"+I.skuNo},success:function(t){t.code==CODEMAP.status.success?m.post({url:"/cart/changeChooseKuyu",data:{productIdAndAttrId:"allRecords",chooseState:!1},success:function(t){if(t.code==CODEMAP.status.success){var e=$("#buyNum").val();m.post({url:"/front/product/addProductToCart",data:{productUuid:P,buyNum:e,attrId:I.skuNo},success:function(t){_smq.push(["custom","PC","goumai"]),
t.code==CODEMAP.status.success?window.location.href="/pages/productInfo/productInfo.html":t.code==CODEMAP.status.notLogin||"403"==t.code?d():Msg.Alert("",t.retData,function(){})}})}}}):Msg.Alert("","请先登录",function(){window.location.href="http://user.tcl.com/proxy/login?from="+N})}})},k.toAddtoCartBuy=function(t){if($(t).hasClass("bespoke"))return!1;var e=$("#buyNum").val();m.post({url:"/front/product/addProductToCart",data:{productUuid:P,buyNum:e,attrId:I.skuNo},success:function(t){t.code==CODEMAP.status.success?Msg.Alert("温馨提示","已加入购物车",function(){}):t.code==CODEMAP.status.notLogin||"403"==t.code?d():Msg.Alert("",t.retData,function(){})}})},p.Ready(function(){a(P),i(P),B.ImgShow(),n(w),o(),s($("#details-l").html()),$("#details-l img").lazyload({placeholder:"../../app/images/lazy.png",threshold:180,effect:"fadeIn"}),$(".reply-img img").lazyload({placeholder:"../../app/images/loadbg.gif",threshold:180,effect:"fadeIn"}),h.init()});try{rtgsettings={pdt_id:$("#productUuid").val(),pdt_price:$("#productPrice").val(),pdt_amount:$("#productBasePrice").val(),pdt_currency:"¥",pdt_url:location.href,pagetype:"product",key:"DIR",token:"TCL_CN",layer:"iframe"},function(t){var e=t.createElement("script");e.async=!0,e.id="madv2014rtg",e.type="text/javascript",e.src=("https:"==t.location.protocol?"https:":"http:")+"//www.mainadv.com/Visibility/Rtgdir2-min.js";var a=t.getElementsByTagName("script")[0];a.parentNode.insertBefore(e,a)}(document)}catch(t){throw t}});