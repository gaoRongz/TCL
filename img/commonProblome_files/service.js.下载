define("KUYU.Service",["KUYU.netBridge","KUYU.Util","KUYU.Store"],function(){var e=KUYU.netBridge,o=new Date,t=0,i=KUYU.Util,n=KUYU.Init,r=KUYU.Store,a=KUYU.Init.getParam(),s=n.getApi();n.cookie();var c=function(o){e.getDeviceInfo(o)};a.fanliCookie&&$.cookie("fanliCookie",a.fanliCookie,{expires:30,path:"/"}),a["ihome-token"]&&$.cookie("_ihome_token_",a["ihome-token"],{expires:1,path:"/"});var l={param:function(e){return{limit:e.size,page:e.page,isMobile:"1"}},result:function(e){var o={code:1},t=e.result;return e.success&&t&&(o={code:0,list:t}),o}},u=function(e){var o=e.split("|"),t=null,i=null;if(o.length>1)for(var n=o[1],r=n.split("&"),a=0;a<r.length;a++){var s=r[a],c=s.split(":"),u=c[0],d=c[1];"param"==u&&(t=l.param[d]),"result"==u&&(i=l.result[d])}return e=o[0],{u:e,p:t,r:i}},d=function(i){var a=n.getEnv(),c=a.sever.toLocaleLowerCase(),l=n.getService();i.showLoading&&0===t&&(e.showLoading(),o=new Date),t++,i.complete=function(){--t<=0&&e.removeLoading()};var d=i.url,v=!1;if(d.split("http").length>1)d=i.url;else if(void 0!=s&&void 0!=s[d]){var f=s[d],p=f.url;v=f.security;var h=p.split("%");if(h.length>1){var m=(c+h[0]).toLocaleLowerCase();i.url=l[m]+h[1]}else if(p.split("http").length>1)i.url=p;else{var c=a.sever.toLocaleLowerCase();""==l[c]&&"file://"!=window.location.origin&&(l[c]=window.location.origin+"/"),i.url=l[c]+p}}else{var c=a.sever.toLocaleLowerCase();""==l[c]&&(l[c]=window.location.origin+"/"),i.url=l[c]+d}var g=u(i.url);i.url=g.u;var k=g.p,_=g.r;if($.isFunction(k)&&(i.data=k(i.data)),i.security=v,$.isFunction(_)){var U=$.extend(!0,{},{},i);if(!0===U.Cache){var w=r.get(U);void 0!=w&&U.success(w)}i.success=function(o){0!=o.code&&o.transId&&Array.of&&console.info("transId:"+o.transId),e.removeLoading();var t=_(o);t&&0==t.status&&t.data.token&&r.set("_ihome_token_",t.token),!0===U.Cache&&0==t.code&&r.set(U,t),U.success(t)}}else{var U=$.extend(!0,{},{},i);if(!0===U.Cache){var w=r.get(U);void 0!=w&&U.success(w)}i.success=function(o){0!=o.code&&o.transId&&Array.of&&console.info("transId:"+o.transId),e.removeLoading(),o&&0==o.code&&o.token&&r.set("_ihome_token_",o.token),!0===U.Cache&&0==o.code&&r.set(U,o),U.success(o)}}e.fetch(i)},v=function(e,o){e.type=o,e.contentType=e.contentType?e.contentType:"application/x-www-form-urlencoded",$.cookie("ihome-token")&&r.set("_ihome_token_",$.cookie("ihome-token")),$.cookie("_ihome_token_")&&r.set("_ihome_token_",$.cookie("_ihome_token_"));var t=r.get("_ihome_token_"),a=$.extend(!0,{},{"ihome-timestamp":i.cTimestamp(),uid:i.cTimestamp()+"-"+i.generateUUID(),"ihome-version":n.getApiVersion(),appversion:n.getApiVersion(),"ihome-token":t,platform:"platform_tcl_shop"},n.getHeaders());return $.extend(!0,{},{headers:a},e)},f={get:function(e,o){var t=v(e,"GET");c(function(e){t.headers.deviceToken=e.deviceToken,d(t)})},post:function(o,t){var i=v(o,"POST");e.getEnv(function(e){c(function(e){i.headers.deviceToken=e.deviceToken,d(i)})})}};_APP.inject("KUYU.Service",f)});